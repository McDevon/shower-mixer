(window["webpackJsonpshower-mixer"]=window["webpackJsonpshower-mixer"]||[]).push([[0],{11:function(t,e,i){t.exports=i(17)},16:function(t,e,i){},17:function(t,e,i){"use strict";i.r(e);var n=i(0),r=i.n(n),a=i(5),s=i.n(a),h=(i(16),function(){return r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement("p",null,"Copyright (c) Jussi Enroos 2019",r.a.createElement("br",null),r.a.createElement("a",{href:"https://github.com/McDevon/shower-mixer"},"Source")," with MIT license"))}),o=i(6),c=i(10),l=function(t,e){if(void 0!==typeof t.getContext){!function(){for(var t=["webkit","moz"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"]}();var i=t.getContext("2d"),n=(new Date).getTime(),r=0,a=0,s=0,h=0;t.simulation=e,e.init(t);!function t(){for(window.requestAnimationFrame(t),r=(new Date).getTime(),a=Math.min((r-n)/1e3,.03),h=0,(s+=a)<1/60&&(s=1/60);s>=1/60&&h<1;)e.fixedUpdate(1/60),s-=1/60,h++;h>=1&&(s=0),e.update(a),e.render(i),n=r}()}},u=i(2),m=i(3),p=function(){function t(e){Object(u.a)(this,t),this.size=e,this.buffer=[],this.buffer.length=e,this.nextIndex=0}return Object(m.a)(t,[{key:"put",value:function(t){this.buffer[this.nextIndex]=t,this.nextIndex=(this.nextIndex+1)%this.size}},{key:"getHead",value:function(){return this.buffer[(this.nextIndex-1)%this.size]}},{key:"getTail",value:function(){return this.buffer[this.nextIndex]}},{key:"getAll",value:function(){for(var t=this.nextIndex,e=[],i=0;i<this.size;i++)e.push(this.buffer[t]),t=(t+1)%this.size;return e}}]),t}(),x=function(){function t(e,i,n,r,a,s){Object(u.a)(this,t),this.margin=5,this.width=r.width-2*this.margin,this.height=r.height-2*this.margin,this.maxVals=e,this.top=i,this.bottom=n,this.targetTop=a,this.targetBottom=s,this.stepLength=this.width/e,this.verticalStep=this.height/(i-n),this.cx=r.getContext("2d")}return Object(m.a)(t,[{key:"draw",value:function(t){var e=this.pixel(this.margin),i=this.pixel(this.margin),n=this.pixel(e+this.width-2*this.margin),r=this.pixel(i+this.height-2*this.margin);this.cx.strokeStyle="#FFAA00",this.cx.lineWidth=1,this.cx.beginPath();for(var a=0,s=t.length;a<s;a++){var h=t[a],o=e+this.stepLength*a,c=i+this.height-this.verticalStep*(h-this.bottom);0===a?this.cx.moveTo(o,c):this.cx.lineTo(o,c)}this.cx.stroke(),this.cx.strokeStyle="#000000",this.cx.fillStyle="#000000",this.cx.lineWidth=1,this.cx.beginPath(),this.cx.moveTo(e,i),this.cx.lineTo(e,r),this.cx.stroke(),this.cx.beginPath(),this.cx.moveTo(e,i),this.cx.lineTo(e-2,i+10),this.cx.lineTo(e+2,i+10),this.cx.fill(),this.cx.beginPath(),this.cx.moveTo(e,r),this.cx.lineTo(n,r),this.cx.stroke(),this.cx.beginPath(),this.cx.moveTo(n,r),this.cx.lineTo(n-10,r-2),this.cx.lineTo(n-10,r+2),this.cx.fill(),this.cx.strokeStyle="#77AA77",this.cx.beginPath(),this.cx.moveTo(e,this.pixel(i+this.height-this.verticalStep*(this.targetTop-this.bottom))),this.cx.lineTo(n,this.pixel(i+this.height-this.verticalStep*(this.targetTop-this.bottom))),this.cx.moveTo(e,this.pixel(i+this.height-this.verticalStep*(this.targetBottom-this.bottom))),this.cx.lineTo(n,this.pixel(i+this.height-this.verticalStep*(this.targetBottom-this.bottom))),this.cx.stroke()}},{key:"pixel",value:function(t){return Math.round(t)+.5}}]),t}(),g=function(){function t(){Object(u.a)(this,t)}return Object(m.a)(t,[{key:"init",value:function(t){this.canvas=t,this.width=t.width,this.height=t.height;this.delayQueue=new p(180),this.running=!0,this.targetTemperature=36,this.minTemperature=15,this.maxTemperature=55,this.maxChangeSpeed=4,this.maxDeltaSpeed=.02,this.lastDiff=0,this.reset()}},{key:"reset",value:function(){this.controlMinTemperature=this.minTemperature+12*Math.random(),this.controlMaxTemperature=this.maxTemperature-10*Math.random(),this.currentTemperature=this.controlMinTemperature+3*Math.random(),this.mixerTemperature=this.currentTemperature;for(var t=0;t<this.delayQueue.size;t++)this.delayQueue.put(this.currentTemperature);return this.graphList=new p(1800),this.plotter=new x(1800,this.maxTemperature,this.minTemperature,this.canvas,this.targetTemperature+.5,this.targetTemperature-.5),1-(this.mixerTemperature-this.controlMinTemperature)/(this.controlMaxTemperature-this.controlMinTemperature)}},{key:"setMixer",value:function(t){this.mixerTemperature=this.controlMinTemperature+(this.controlMaxTemperature-this.controlMinTemperature)*(1-t),console.log("Target ".concat(this.mixerTemperature))}},{key:"fixedUpdate",value:function(t){var e=this.mixerTemperature-this.currentTemperature,i=e,n=this.maxChangeSpeed/(this.maxDeltaSpeed*t);if(Math.abs(e)<n){var r=Math.abs(e)*this.maxDeltaSpeed;i=Math.sign(e)*r}Math.abs(i)>this.maxChangeSpeed*t&&(i=this.maxChangeSpeed*Math.sign(i)*t),Math.abs(i)>Math.abs(this.lastDiff)&&Math.abs(this.lastDiff-i)>this.maxDeltaSpeed*t&&(i=this.lastDiff+this.maxDeltaSpeed*t*Math.sign(i)),this.lastDiff=i,this.currentTemperature+=i;var a=this.delayQueue.getTail();this.delayQueue.put(this.currentTemperature),this.graphList.put(a)}},{key:"update",value:function(t){}},{key:"render",value:function(t){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.plotter.draw(this.graphList.getAll().filter(function(t){return null!=t}))}}]),t}(),f=function(){return new g},d=i(9),v=function(t){var e=t.value,i=t.step,n=t.min,a=t.max,s=t.onChange;t.suffix;return console.log("Mixer value ".concat(e)),r.a.createElement("div",{style:{marginTop:"5px",marginLeft:"5px",marginRight:"5px",marginBottom:"5px"}},r.a.createElement(d.a,{axis:"y",ystep:i,ymin:n,ymax:a,y:e,onChange:s(),styles:{track:{backgroundColor:"red",height:300},active:{backgroundColor:"blue"}}}))};function w(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}var b=function(t){var e=Object(n.useState)({mixer:1}),i=Object(c.a)(e,2),a=i[0],s=i[1],h=Object(n.useRef)(null);return Object(n.useEffect)(function(){console.log("start hook"),console.log(t.location.search),l(h.current,f());var e=h.current.simulation.reset();s({mixer:e})},[]),r.a.createElement("div",null,r.a.createElement("div",{style:{paddingLeft:"25px",paddingRight:"25px"}},r.a.createElement("h1",null,"Have a Nice Shower"),r.a.createElement("p",null,"You are entering a shower. But it's way too cold! Use the shower mixer controls to set the temperature to a reasonable setting."),r.a.createElement("p",null,"You can follow the current temperature from the graph below. The proper temperature is marked with the green lines, so aim to get the temperature between them.")),r.a.createElement("canvas",{style:{marginLeft:"5px",marginRight:"5px",paddingLeft:"25px",paddingRight:"25px",paddingTop:"10px"},ref:h,width:"590",height:"400"}),r.a.createElement("div",{style:{paddingLeft:"25px",paddingRight:"25px"}},r.a.createElement("div",{style:{display:"inline-block",verticalAlign:"top",width:"200px",marginLeft:"5px",marginRight:"5px"}},r.a.createElement("div",null,"Shower Mixer Control"),r.a.createElement(v,{value:a.mixer,min:0,max:1,step:.0025,onChange:function(){return function(t){var e=t.y;return function(t){var e={mixer:t.mixer};s(e),h.current.simulation.setMixer(e.mixer)}(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?w(i,!0).forEach(function(e){Object(o.a)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):w(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}({},a,{mixer:e}))}}}))))},T=function(t){return Object(n.useEffect)(function(){console.log("app effect")}),r.a.createElement("div",{style:{marginLeft:"auto",marginRight:"auto",maxWidth:"600px"}},r.a.createElement(b,{location:window.location}),r.a.createElement(h,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[11,1,2]]]);
//# sourceMappingURL=main.6405cbee.chunk.js.map