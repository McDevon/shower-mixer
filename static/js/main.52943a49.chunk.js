(window["webpackJsonpshower-mixer"]=window["webpackJsonpshower-mixer"]||[]).push([[0],{11:function(t,e,i){t.exports=i(17)},16:function(t,e,i){},17:function(t,e,i){"use strict";i.r(e);var r=i(0),n=i.n(r),a=i(5),s=i.n(a),o=(i(16),function(){return n.a.createElement("div",{style:{textAlign:"right"}},n.a.createElement("p",null,"Copyright (c) Jussi Enroos 2019",n.a.createElement("br",null),n.a.createElement("a",{href:"https://github.com/McDevon/shower-mixer"},"Source")," with MIT license"))}),h=i(6),c=i(10),u=function(t,e){if(void 0!==typeof t.getContext){!function(){for(var t=["webkit","moz"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"]}();var i=t.getContext("2d"),r=(new Date).getTime(),n=0,a=0,s=0,o=0;t.simulation=e,e.init(t);!function t(){for(window.requestAnimationFrame(t),n=(new Date).getTime(),a=Math.min((n-r)/1e3,.03),o=0,(s+=a)<1/60&&(s=1/60);s>=1/60&&o<1;)e.fixedUpdate(1/60),s-=1/60,o++;o>=1&&(s=0),e.update(a),e.render(i),r=n}()}},l=i(2),m=i(3),p=function(){function t(e){Object(l.a)(this,t),this.size=e,this.buffer=[],this.buffer.length=e,this.nextIndex=0}return Object(m.a)(t,[{key:"put",value:function(t){this.buffer[this.nextIndex]=t,this.nextIndex=(this.nextIndex+1)%this.size}},{key:"getHead",value:function(){return this.buffer[(this.nextIndex-1)%this.size]}},{key:"getTail",value:function(){return this.buffer[this.nextIndex]}},{key:"getAll",value:function(){for(var t=this.nextIndex,e=[],i=0;i<this.size;i++)e.push(this.buffer[t]),t=(t+1)%this.size;return e}}]),t}(),f=function(){function t(e,i,r,n,a,s,o,h){Object(l.a)(this,t),this.width=e,this.height=i,this.maxVals=r,this.top=n,this.bottom=a,this.targetTop=o,this.targetBottom=h,this.stepLength=e/r,this.verticalStep=i/(n-a),this.cx=s.getContext("2d")}return Object(m.a)(t,[{key:"draw",value:function(t,e,i){this.cx.strokeStyle="#FFAA00",this.cx.lineWidth=2,this.cx.beginPath();for(var r=0,n=i.length;r<n;r++){var a=i[r],s=t+this.stepLength*r,o=e+this.height-this.verticalStep*(a-this.bottom);0===r?this.cx.moveTo(s,o):this.cx.lineTo(s,o)}this.cx.stroke(),this.cx.strokeStyle="#000000",this.cx.lineWidth=1,this.cx.beginPath(),this.cx.moveTo(t,e),this.cx.lineTo(t,e+this.height),this.cx.stroke(),this.cx.strokeStyle="#777777",this.cx.beginPath(),this.cx.moveTo(t,e+this.height-this.verticalStep*(this.targetTop-this.bottom)),this.cx.lineTo(t+this.width,e+this.height-this.verticalStep*(this.targetTop-this.bottom)),this.cx.moveTo(t,e+this.height-this.verticalStep*(this.targetBottom-this.bottom)),this.cx.lineTo(t+this.width,e+this.height-this.verticalStep*(this.targetBottom-this.bottom)),this.cx.stroke()}}]),t}(),x=function(){function t(){Object(l.a)(this,t)}return Object(m.a)(t,[{key:"init",value:function(t){this.canvas=t,this.width=t.width,this.height=t.height;this.delayQueue=new p(180),this.running=!0,this.targetTemperature=36,this.minTemperature=15,this.maxTemperature=55,this.maxChangeSpeed=4,this.maxDeltaSpeed=.02,this.lastDiff=0,this.reset()}},{key:"reset",value:function(){this.controlMinTemperature=this.minTemperature+12*Math.random(),this.controlMaxTemperature=this.maxTemperature-10*Math.random(),this.currentTemperature=this.controlMinTemperature+3*Math.random(),this.mixerTemperature=this.currentTemperature;for(var t=0;t<this.delayQueue.size;t++)this.delayQueue.put(this.currentTemperature);return this.graphList=new p(1800),this.plotter=new f(550,350,1800,this.maxTemperature,this.minTemperature,this.canvas,this.targetTemperature+.5,this.targetTemperature-.5),1-(this.mixerTemperature-this.controlMinTemperature)/(this.controlMaxTemperature-this.controlMinTemperature)}},{key:"setMixer",value:function(t){this.mixerTemperature=this.controlMinTemperature+(this.controlMaxTemperature-this.controlMinTemperature)*(1-t),console.log("Target ".concat(this.mixerTemperature))}},{key:"fixedUpdate",value:function(t){var e=this.mixerTemperature-this.currentTemperature,i=e,r=this.maxChangeSpeed/(this.maxDeltaSpeed*t);if(Math.abs(e)<r){var n=Math.abs(e)*this.maxDeltaSpeed;i=Math.sign(e)*n}Math.abs(i)>this.maxChangeSpeed*t&&(i=this.maxChangeSpeed*Math.sign(i)*t),Math.abs(i)>Math.abs(this.lastDiff)&&Math.abs(this.lastDiff-i)>this.maxDeltaSpeed*t&&(i=this.lastDiff+this.maxDeltaSpeed*t*Math.sign(i)),this.lastDiff=i,this.currentTemperature+=i;var a=this.delayQueue.getTail();this.delayQueue.put(this.currentTemperature),this.graphList.put(a)}},{key:"update",value:function(t){}},{key:"render",value:function(t){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.plotter.draw(25,25,this.graphList.getAll().filter(function(t){return null!=t}))}}]),t}(),g=function(){return new x},d=i(9),v=function(t){var e=t.value,i=t.step,r=t.min,a=t.max,s=t.onChange;t.suffix;return console.log("Mixer value ".concat(e)),n.a.createElement("div",{style:{marginTop:"5px",marginLeft:"5px",marginRight:"5px",marginBottom:"5px"}},n.a.createElement(d.a,{axis:"y",ystep:i,ymin:r,ymax:a,y:e,onChange:s(),styles:{track:{backgroundColor:"red",height:300},active:{backgroundColor:"blue"}}}))};function w(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)}return i}var b=function(t){var e=Object(r.useState)({mixer:1}),i=Object(c.a)(e,2),a=i[0],s=i[1],o=Object(r.useRef)(null);return Object(r.useEffect)(function(){console.log("start hook"),console.log(t.location.search),u(o.current,g());var e=o.current.simulation.reset();s({mixer:e})},[]),n.a.createElement("div",null,n.a.createElement("canvas",{ref:o,width:"600",height:"400"}),n.a.createElement("div",{style:{paddingLeft:"25px",paddingRight:"25px"}},n.a.createElement("div",{style:{display:"inline-block",verticalAlign:"top",width:"200px",marginLeft:"5px",marginRight:"5px"}},n.a.createElement("div",null,"Shower Mixer Control"),n.a.createElement(v,{value:a.mixer,min:0,max:1,step:.0025,onChange:function(){return function(t){var e=t.y;return function(t){var e={mixer:t.mixer};s(e),o.current.simulation.setMixer(e.mixer)}(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?w(i,!0).forEach(function(e){Object(h.a)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):w(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}({},a,{mixer:e}))}}}))))},y=function(t){return Object(r.useEffect)(function(){console.log("app effect")}),n.a.createElement("div",{style:{marginLeft:"auto",marginRight:"auto",maxWidth:"600px"}},n.a.createElement(b,{location:window.location}),n.a.createElement(o,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(n.a.createElement(y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[11,1,2]]]);
//# sourceMappingURL=main.52943a49.chunk.js.map