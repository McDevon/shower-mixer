{"version":3,"sources":["components/Footer.js","simulations/RenderLoop.js","simulations/RingBuffer.js","simulations/Plotter.js","simulations/PidController.js","simulations/ShowerSim.js","components/ShowerControl.js","components/LabelSlider.js","components/PidControls.js","components/Button.js","components/InfoColumn.js","components/TitleArea.js","components/ShowerMixer.js","App.js","serviceWorker.js","index.js"],"names":["Footer","style","textAlign","href","startRender","canvas","item","undefined","getContext","vendors","x","length","window","requestAnimationFrame","cancelAnimationFrame","vendorCheck","cx","lastTime","Date","getTime","currentTime","dt","fixedDeltaCounter","fixedCount","simulation","init","simulationLoop","Math","min","fixedUpdate","update","render","RingBuffer","size","this","buffer","nextIndex","value","index","ret","i","push","Plotter","maxVals","top","bottom","targetTop","targetBottom","margin","width","height","stepLength","verticalStep","prevx","prevStartX","posTop","posBottom","region","stroke","fillStyle","lineTo","fill","data","x0","pixel","y0","x1","y1","strokeStyle","lineWidth","prevy","prevRegion","beginPath","moveTo","prevValue","count","xd","yd","drawChartLine","round","PidController","p","d","minU","maxU","antiWindup","e","lastE","iTerm","current","target","newI","u","enableAntiWindup","ShowerSimulation","delayQueue","delaySeconds","running","targetTemperature","minTemperature","maxTemperature","maxChangeSpeed","completionTime","completeTimer","maxDeltaSpeed","lastDiff","pidControlValue","usePid","reset","completionCallback","pidCallback","controlMinTemperature","random","controlMaxTemperature","currentTemperature","mixerTemperature","put","graphList","plotter","pid","tempToMixer","console","log","mixerValue","mixerToTemp","step","getTail","distance","diff","slowDist","abs","mul","sign","nextTempValue","completed","_","clearRect","draw","getAll","filter","el","showerSim","ShowerControl","max","onChange","suffix","marginTop","marginLeft","marginRight","marginBottom","axis","ystep","ymin","ymax","y","styles","track","backgroundColor","active","LabelSlider","label","labelValue","xstep","xmin","xmax","PidControls","changePid","padding","toFixed","maxP","Button","onClick","text","disabled","StyledButton","styled","button","InfoColumn","pure","visible","showPid","pidSelected","restartSelected","fullColumnStyle","display","verticalAlign","TitleArea","startSelected","startDisabled","paddingLeft","paddingRight","ShowerMixer","props","state","shower","page","canvasElement","React","createRef","setRunning","newState","setState","controlValue","event","preventDefault","pageState","setPidValues","setUsePid","newPid","changeShower","mixer","setMixer","showerVal","paddingTop","ref","Component","App","useEffect","maxWidth","location","Boolean","hostname","match","ReactDOM","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.cc000e00.chunk.js","sourcesContent":["import React from 'react'\n\nconst Footer = () => {\n\n    const style = {\n        textAlign: 'right'\n    }\n\n    return <div style={style}>\n        <p>Copyright (c) Jussi Enroos 2019<br />\n        <a href='https://github.com/McDevon/shower-mixer'>Source</a> with MIT license</p>\n    </div>\n}\n\nexport default Footer","const vendorCheck = () => {\n    const vendors = ['webkit', 'moz'];\n    for (let x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n        window.cancelAnimationFrame =\n            window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];\n    }\n}\n\nconst startRender = (canvas, item) => {\n    if (typeof (canvas.getContext) === undefined) {\n        return\n    }\n\n    vendorCheck()\n\n    let cx = canvas.getContext('2d'),\n        lastTime = (new Date()).getTime(),\n        currentTime = 0,\n        dt = 0,\n        fixedDeltaCounter = 0,\n        fixedCount = 0\n    \n    const maxLoops = 1,\n        fixedDelta = 1.0/60\n    \n    canvas.simulation = item\n    item.init(canvas)\n\n    const simulationLoop = () => {\n        window.requestAnimationFrame(simulationLoop)\n\n        currentTime = (new Date()).getTime()\n        dt = Math.min((currentTime - lastTime) / 1000, 0.03)\n\n        fixedDeltaCounter += dt\t\t\n        fixedCount = 0\n\t\t\n\t\tif (fixedDeltaCounter < fixedDelta) {\n\t\t\tfixedDeltaCounter = fixedDelta\n\t\t}\n\t\t\n\t\twhile (fixedDeltaCounter >= fixedDelta && fixedCount < maxLoops) {\n\t\t\titem.fixedUpdate(fixedDelta)\n\t\t\tfixedDeltaCounter -= fixedDelta\n\t\t\tfixedCount++\n\t\t}\n\t\t\n\t\tif (fixedCount >= maxLoops) {\n\t\t\tfixedDeltaCounter = 0\n\t\t}\n\n        item.update(dt)\n\n        item.render(cx)\n\n        lastTime = currentTime\n    }\n\n    simulationLoop()\n}\n\nexport default startRender","class RingBuffer {\n    constructor(size) {\n        this.size = size\n        this.buffer = []\n        this.buffer.length = size\n        this.nextIndex = 0\n    }\n\n    put(value) {\n        this.buffer[this.nextIndex] = value\n        this.nextIndex = (this.nextIndex + 1) % this.size\n    }\n\n    getHead() {\n        return this.buffer[(this.nextIndex - 1) % this.size]\n    }\n\n    getTail() {\n        return this.buffer[this.nextIndex]\n    }\n\n    getAll() {\n        let index = this.nextIndex\n        let ret = []\n        for (let i = 0; i < this.size; i++) {\n            ret.push(this.buffer[index])\n            index = (index + 1) % this.size\n        }\n        return ret\n    }\n\n}\n\nexport default RingBuffer","\nclass Plotter {\n\n    constructor(maxVals, top, bottom, canvas, targetTop, targetBottom) {\n        this.margin = 5\n        this.width = canvas.width - this.margin * 2\n        this.height = canvas.height - this.margin * 2\n        this.maxVals = maxVals\n        this.top = top\n        this.bottom = bottom\n        this.targetTop = targetTop\n        this.targetBottom = targetBottom\n        this.stepLength = (this.width - this.margin * 2) / maxVals\n        this.verticalStep = (this.height - this.margin * 2) / (top - bottom)\n        this.cx = canvas.getContext('2d')\n    }\n\n    drawChartLine(value, prevx, prevStartX, posTop, posBottom, region) {\n        this.cx.stroke()\n        \n        if (region !== 1) {\n            this.cx.fillStyle = region === 0 ? '#BBBBFF55' : '#FFBBBB55'\n            this.cx.lineTo(prevx, value < this.targetBottom ? posBottom : posTop)\n            this.cx.lineTo(prevStartX, value < this.targetBottom ? posBottom : posTop)\n            this.cx.fill()\n        }\n    }\n\n    draw(data) {\n\n        const x0 = this.pixel(this.margin), y0 = this.pixel(this.margin)\n        const x1 = this.pixel(x0 + this.width - this.margin * 2), y1 = this.pixel(y0 + this.height - this.margin * 2)\n        \n        const posTop = y0 + this.height - (this.verticalStep * (this.targetTop - this.bottom))\n        const posBottom = y0 + this.height - (this.verticalStep * (this.targetBottom - this.bottom))\n        this.cx.strokeStyle = '#002200'\n        this.cx.lineWidth = 2\n        let prevx = x0, prevy = y0 + this.height - (this.verticalStep * (data[0] - this.bottom))\n        let prevRegion = 1\n\n        this.cx.beginPath()\n        this.cx.moveTo(prevx, prevy)\n\n        let prevStartX = x0\n        let prevValue = data[0]\n        for (let i = 0, count = data.length; i < count; i++) {\n            const value = data[i]\n            const region = value < this.targetBottom ? 0 : value > this.targetTop ? 2 : 1\n            const xd = x0 + this.stepLength * i\n            const yd = y0 + this.height - (this.verticalStep * (value - this.bottom))\n            if (region !== prevRegion) {\n                this.drawChartLine(prevValue, prevx, prevStartX, posTop, posBottom, prevRegion)\n                this.cx.beginPath()\n                this.cx.moveTo(prevx, prevy)\n                prevRegion = region\n                prevStartX = prevx\n                prevValue = value\n            }\n            this.cx.lineTo(xd, yd)\n\n            prevx = xd\n            prevy = yd\n        }\n        this.drawChartLine(prevValue, prevx, prevStartX, posTop, posBottom, prevRegion)\n        \n        this.cx.strokeStyle = '#000000'\n        this.cx.fillStyle = '#000000'\n        this.cx.lineWidth = 1\n\n        this.cx.beginPath()\n        this.cx.moveTo(x0, y0)\n        this.cx.lineTo(x0, y1)\n        this.cx.stroke()\n        this.cx.beginPath()\n        this.cx.moveTo(x0, y0)\n        this.cx.lineTo(x0 - 2, y0 + 10)\n        this.cx.lineTo(x0 + 2, y0 + 10)\n        this.cx.fill()\n\n        this.cx.beginPath()\n        this.cx.moveTo(x0, y1)\n        this.cx.lineTo(x1, y1)\n        this.cx.stroke()\n        this.cx.beginPath()\n        this.cx.moveTo(x1, y1)\n        this.cx.lineTo(x1 - 10, y1 - 2)\n        this.cx.lineTo(x1 - 10, y1 + 2)\n        this.cx.fill()\n\n        this.cx.strokeStyle = '#77AA77'\n        this.cx.beginPath()\n        this.cx.moveTo(x0, this.pixel(y0 + this.height - (this.verticalStep * (this.targetTop - this.bottom))))\n        this.cx.lineTo(x1, this.pixel(y0 + this.height - (this.verticalStep * (this.targetTop - this.bottom))))\n        this.cx.moveTo(x0, this.pixel(y0 + this.height - (this.verticalStep * (this.targetBottom - this.bottom))))\n        this.cx.lineTo(x1, this.pixel(y0 + this.height - (this.verticalStep * (this.targetBottom - this.bottom))))\n        this.cx.stroke()\n    }\n\n    pixel(value) {\n        return Math.round(value) + 0.5\n    }\n}\n\nexport default Plotter","class PidController {\n    constructor(p, i, d, minU, maxU, antiWindup = false) {\n        this.e = 0\n        this.lastE = 0\n        this.p = p\n        this.i = i\n        this.d = d\n        this.minU = minU\n        this.maxU = maxU\n        this.iTerm = 0\n        this.antiWindup = antiWindup\n    }\n\n    step(current, target) {\n\n        const e = target - current\n        const newI = this.iTerm + e\n        const d = e - this.lastE\n\n        let u = this.p * e + this.i * newI + this.d * d\n\n        let enableAntiWindup = false\n\n        if (u > this.maxU) {\n            u = this.maxU\n            if (this.antiWindup && e > 0) {\n                enableAntiWindup = true\n            }\n        } else if (u < this.minU) {\n            u = this.minU\n            if (this.antiWindup && e < 0) {\n                enableAntiWindup = true\n            }\n        }\n\n        if (!enableAntiWindup) {\n            this.iTerm = newI\n        }\n\n        this.lastE = e\n\n        return u\n    }\n}\n\nexport default PidController","import RingBuffer from \"../simulations/RingBuffer\";\nimport Plotter from \"./Plotter\";\nimport PidController from \"./PidController\";\n\nclass ShowerSimulation {\n\n    init(canvas) {\n        this.canvas = canvas\n\n        this.width = canvas.width\n        this.height = canvas.height\n\n        const delaySeconds = 3\n\n        this.delayQueue = new RingBuffer(delaySeconds * 60)\n        this.running = true\n\n        this.targetTemperature = 36\n        this.minTemperature = 15\n        this.maxTemperature = 55\n        this.maxChangeSpeed = 4\n        this.completionTime = 4\n        this.completeTimer = 0\n\n        this.maxDeltaSpeed = 0.02\n        this.lastDiff = 0\n\n        this.pidControlValue = 0\n\n        this.running = false\n        this.usePid = false\n\n        this.reset()\n    }\n\n    reset(completionCallback, pidCallback) {\n\n        this.controlMinTemperature = this.minTemperature + Math.random() * 12\n        this.controlMaxTemperature = this.maxTemperature - Math.random() * 10\n        this.currentTemperature = this.controlMinTemperature + Math.random() * 3\n        this.mixerTemperature = this.currentTemperature\n        this.completionCallback = completionCallback\n        this.pidCallback = pidCallback\n\n        for (let i = 0; i < this.delayQueue.size; i++) {\n            this.delayQueue.put(this.currentTemperature)\n        }\n\n        const graphLen = 30 * 60\n        this.graphList = new RingBuffer(graphLen)\n\n        this.plotter = new Plotter(\n            graphLen,\n            this.maxTemperature,\n            this.minTemperature,\n            this.canvas,\n            this.targetTemperature + 0.5,\n            this.targetTemperature - 0.5\n        )\n\n        this.pid = new PidController(0.001, 0.00015, 0,\n            0, 1, true)\n\n        const mixerValue = this.tempToMixer(this.mixerTemperature)\n        return mixerValue\n    }\n\n    setRunning(value) {\n        this.running = value\n    }\n\n    setUsePid(value) {\n        this.usePid = value\n    }\n\n    setPidValues({p, i, d}) {\n        this.pid.p = p\n        this.pid.i = i\n        this.pid.d = d\n    }\n\n    tempToMixer(value) {\n        return 1 - (value - this.controlMinTemperature) / (this.controlMaxTemperature - this.controlMinTemperature)\n    }\n\n    mixerToTemp(value) {\n        return this.controlMinTemperature + (this.controlMaxTemperature - this.controlMinTemperature) * (1 - value)\n    }\n\n    completed() {\n        console.log('COMPLETED!')\n        this.completionCallback(this.tempToMixer(this.mixerTemperature))\n    }\n\n    setMixer(mixerValue) {\n        this.mixerTemperature = this.mixerToTemp(mixerValue)\n        console.log(`Target ${this.mixerTemperature}`)\n    }\n\n    fixedUpdate(dt) {\n        if (!this.running) { return }\n\n        if (this.usePid) {\n            this.pidControlValue = 1 - this.pid.step(this.delayQueue.getTail() || this.currentTemperature, this.targetTemperature)\n            this.mixerTemperature = this.mixerToTemp(this.pidControlValue)\n        }\n\n        const distance = (this.mixerTemperature - this.currentTemperature)\n        let diff = distance\n        const slowDist = this.maxChangeSpeed / (this.maxDeltaSpeed * dt)\n        if (Math.abs(distance) < slowDist) {\n            const mul = Math.abs(distance) * this.maxDeltaSpeed\n            diff = Math.sign(distance) * mul\n        }\n        if (Math.abs(diff) > this.maxChangeSpeed * dt) {\n            diff = this.maxChangeSpeed * Math.sign(diff) * dt\n        }\n\n        if (Math.abs(diff) > Math.abs(this.lastDiff) && Math.abs(this.lastDiff - diff) > this.maxDeltaSpeed * dt) {\n            diff = this.lastDiff + this.maxDeltaSpeed * dt * Math.sign(diff)\n        }\n\n        this.lastDiff = diff\n        this.currentTemperature += diff\n\n        const nextTempValue = this.delayQueue.getTail()\n        this.delayQueue.put(this.currentTemperature)\n        this.graphList.put(nextTempValue)\n\n        if (nextTempValue < this.targetTemperature + 0.5 && nextTempValue > this.targetTemperature - 0.5) {\n            this.completeTimer += dt\n            if (this.completeTimer >= this.completionTime) {\n                this.completed()\n            }\n        } else {\n            this.completeTimer = 0\n        }\n    }\n\n    update(_) {\n        if (this.usePid) {\n            this.pidCallback(this.pidControlValue)\n        }\n    }\n\n    render(_) {\n        const context = this.canvas.getContext('2d')\n        context.clearRect(0, 0, this.canvas.width, this.canvas.height)\n\n        this.plotter.draw(this.graphList.getAll().filter(function (el) {\n            return el != null;\n        }))\n    }\n}\n\nconst showerSim = () => {\n    return new ShowerSimulation()\n}\n\nexport default showerSim","import React from 'react'\nimport Slider from 'react-input-slider'\n\nconst ShowerControl = ({ value, step, min, max, onChange, suffix='' }) => {\n    const divStyle = {\n        marginTop: '5px',\n        marginLeft: '5px',\n        marginRight: '5px',\n        marginBottom: '5px'\n    }\n    console.log(`Mixer value ${value}`)\n    return <div style={divStyle}>\n        <Slider\n            axis=\"y\"\n            ystep={step}\n            ymin={min}\n            ymax={max}\n            y={value}\n            onChange={onChange()}\n            styles={{\n                track: {\n                  backgroundColor: 'red',\n                  height: 300\n                },\n                active: {\n                  backgroundColor: 'blue'\n                }\n              }}\n        />\n    </div>\n}\n\nexport default ShowerControl","import React from 'react'\nimport Slider from 'react-input-slider'\n\nconst LabelSlider = ({ label, value, step, min, max, onChange, suffix='', labelValue=value }) => {\n    const divStyle = {\n        marginTop: '5px',\n        marginLeft: '5px',\n        marginRight: '5px',\n        marginBottom: '5px'\n    }\n    return <div style={divStyle}>\n        <div>\n            {`${label}: ${labelValue}${suffix}`}\n        </div>\n        <Slider\n            axis=\"x\"\n            xstep={step}\n            xmin={min}\n            xmax={max}\n            x={value}\n            onChange={onChange()}\n        />\n    </div>\n}\n\nexport default LabelSlider","import React from 'react'\nimport LabelSlider from './LabelSlider'\n\nconst PidControls = ({ pid, changePid }) => {\n\n    const style = {\n        padding: '10px 0px'\n    }\n\n    const maxP = 1, maxI = 0.0003, maxD = 5, minD = -5\n    const stepP = maxP / 200.0, stepI = maxI / 200.0, stepD = (maxD - minD) / 200.0\n\n    return <div style={style}>\n        <LabelSlider\n            label='P' value={pid.p} labelValue={(pid.p / maxP).toFixed(3)}\n            min={0} max={maxP} step={stepP}\n            onChange={() => ({x}) => changePid({ ...pid, p: x })}\n        />\n        <LabelSlider\n            label='I' value={pid.i} labelValue={(pid.i / maxI).toFixed(3)}\n            min={0} max={maxI} step={stepI}\n            onChange={() => ({x}) => changePid({ ...pid, i: x })}\n        />\n        <LabelSlider\n            label='D' value={pid.d} labelValue={(pid.d / maxD).toFixed(3)}\n            min={minD} max={maxD} step={stepD}\n            onChange={() => ({x}) => changePid({ ...pid, d: x })}\n        />\n    </div>\n}\n\nexport default PidControls","import React from 'react'\nimport styled from 'styled-components'\n\nconst Button = ({ onClick, text, disabled }) => {\n\n    const StyledButton = styled.button`\n    background-color: ${disabled ? '#c4cfc1' : '#4CAF50'};\n    border: none;\n    border-radius: 4px;\n    color: white;\n    padding: 10px 20px;\n    text-align: center;\n    text-decoration: none;\n    display: inline-block;\n    margin: 0px;\n    font-size: 16px;\n    opacity: ${disabled ? '0.6' : '1'};\n    :hover {\n        background-color: ${disabled ? '#c4cfc1' : '#5bc146'};\n    }\n    :focus {\n        outline: none;\n    }\n    :active {\n        padding: 9px 18px;\n        font-size: 14px;\n        margin: 1px 4px;\n    }\n    `\n\n    const divStyle = {\n        height: '42px'\n    }\n\n    return <div style={divStyle}>\n        <StyledButton onClick={onClick} disabled={disabled}>\n            {text}\n        </StyledButton>\n    </div>\n}\n\nexport default Button","import React from 'react'\nimport PidControls from './PidControls';\nimport Button from './Button';\nimport { pure } from 'recompose'\n\nconst InfoColumn = pure(({ visible, showPid, completed,\n    pidSelected, restartSelected,\n    pid, changePid }) => {\n\n    const fullColumnStyle = {\n        display: 'inline-block',\n        verticalAlign: 'top',\n        width: '370px',\n        marginLeft: '5px',\n        marginRight: '5px'\n    }\n\n    if (showPid) {\n        return <div style={fullColumnStyle}>\n            {'PID controls'}\n            <PidControls\n                pid={pid}\n                changePid={changePid}\n            />\n            <Button text='Restart PID' onClick={pidSelected} />\n            <Button text='Manual Control' onClick={restartSelected} />\n        </div>\n    } else if (visible) {\n        return <div style={fullColumnStyle}>\n            <h2>{'Well done!'}</h2>\n            <p>{\"This demo explores the behaviour of shower users, when there is a noticeable delay between controlling the mixer (input) and the temperature change (output).\"}</p>\n            <p>{\"The hypothesis is that the feedback loop created by the user and the shower makes the system output first oscillate, and then stabilize at the convenient temperature range. Much like a PI controller with a slightly too high integral term would control the system.\"}</p>\n            <Button text='Restart' onClick={restartSelected} disabled={!completed} />\n            <Button text='Run with PI controller' onClick={pidSelected} />\n        </div>\n    } else {\n        return <div style={fullColumnStyle}></div>\n    }\n})\n\nexport default InfoColumn","import React from 'react'\nimport Button from './Button';\nimport { pure } from 'recompose'\n\nconst TitleArea = pure(({ startSelected, startDisabled }) => {\n    const titleAreaStyle = {\n        paddingLeft: '25px',\n        paddingRight: '25px',\n    }\n\n    return <div style={titleAreaStyle}>\n        <h1>{'Have a Nice Shower!'}</h1>\n        <p>{\"You are entering a shower. But it's way too cold! Use the shower mixer controls to set the temperature to a reasonable setting.\"}</p>\n        <p>{\"You can follow the current temperature from the graph below. The convenient zone is marked with the green lines, so aim to get the temperature between them.\"}</p>\n        <Button text='Start' onClick={startSelected} disabled={startDisabled} />\n    </div>\n})\n\nexport default TitleArea","import React, { useState, useEffect, useRef } from 'react'\nimport startRender from '../simulations/RenderLoop'\nimport showerSim from '../simulations/ShowerSim'\nimport ShowerControl from './ShowerControl';\nimport InfoColumn from './InfoColumn';\nimport TitleArea from './TitleArea';\n\nclass ShowerMixer extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            shower: 1,\n            page: {\n                running: 1,\n                completed: 0,\n                pid: 1\n            },\n            pid: {\n                p: 0.001,\n                i: 0.00015,\n                d: 0\n            }\n        }\n        this.canvasElement = React.createRef()\n\n        this.completionCallback = (usePid) => (mixerValue) => {\n            console.log('COMPLETION CALLBACK', this.state.shower, usePid)\n            this.canvasElement.current.simulation.setRunning(false)\n            const newState = {\n                running: 0,\n                completed: 1,\n                pid: usePid\n            }\n            this.setState({ page: newState })\n        }\n        this.pidCallback = (controlValue) => {\n            this.setState({ shower: controlValue })\n        }\n        this.startSelected = (event) => {\n            event.preventDefault()\n            console.log('Start selected')\n            this.canvasElement.current.simulation.setRunning(true)\n            this.setState({ page: {...this.state.pageState, running: 1} })\n        }\n        this.pidSelected = (event) => {\n            event.preventDefault()\n            console.log('PID selected')\n            this.setState({ shower: this.canvasElement.current.simulation.reset(this.completionCallback(1), this.pidCallback) })\n            const newState = {\n                running: 1,\n                completed: 0,\n                pid: 1\n            }\n            this.setState({ page: newState })\n            this.canvasElement.current.simulation.setPidValues(this.state.pid)\n            this.canvasElement.current.simulation.setUsePid(true)\n            this.canvasElement.current.simulation.setRunning(true)\n        }\n        this.restartSelected = (event) => {\n            event.preventDefault()\n            console.log('Restart selected')\n            this.setState({ shower: this.canvasElement.current.simulation.reset(this.completionCallback(0), this.pidCallback) })\n            const newState = {\n                running: 1,\n                completed: 0,\n                pid: 0\n            }\n            this.setState({ page: newState })\n            this.canvasElement.current.simulation.setUsePid(false)\n            this.canvasElement.current.simulation.setRunning(true)\n        }\n        this.changePid = (newPid) => {\n            this.setState({ pid: newPid })\n            this.canvasElement.current.simulation.setPidValues(newPid)\n        }\n        this.changeShower = (mixer) => {\n            console.log('Change shower', mixer)\n            this.setState({ shower: mixer })\n            this.canvasElement.current.simulation.setMixer(mixer)\n        }\n    }\n\n    componentDidMount() {\n        startRender(this.canvasElement.current, showerSim())\n        const showerVal = this.canvasElement.current.simulation.reset(this.completionCallback(this.state.page.pid), this.pidCallback)\n        this.canvasElement.current.simulation.setPidValues(this.state.pid)\n        this.canvasElement.current.simulation.setUsePid(this.state.page.pid)\n        this.canvasElement.current.simulation.setRunning(this.state.page.running)\n        this.setState({ shower: showerVal })\n    }\n\n    render() {\n        const controlAreaStyle = {\n            paddingLeft: '25px',\n            width: '590px',\n            paddingRight: '25px',\n        }\n        const columnStyle = {\n            display: 'inline-block',\n            verticalAlign: 'top',\n            width: '200px',\n            marginLeft: '5px',\n            marginRight: '5px'\n        }\n        const canvasStyle = {\n            marginLeft: '5px',\n            marginRight: '5px',\n            paddingLeft: '25px',\n            paddingRight: '25px',\n            paddingTop: '10px'\n        }\n\n        return <div>\n            <TitleArea\n                startSelected={this.startSelected}\n                startDisabled={this.state.page.running || this.state.page.completed} />\n            <canvas style={canvasStyle} ref={this.canvasElement} width='590' height='400' />\n            <div style={controlAreaStyle}>\n                <div style={columnStyle}>\n                    <div>\n                        {'Shower Mixer Control'}\n                    </div>\n                    <ShowerControl\n                        value={this.state.shower}\n                        min={0} max={1} step={0.0025}\n                        onChange={() => ({ y }) => { if (this.state.page.running && !this.state.page.pid) this.changeShower(y) }}\n                    />\n                </div>\n                <InfoColumn visible={this.state.page.completed} showPid={this.state.page.pid}\n                    pidSelected={this.pidSelected} restartSelected={this.restartSelected}\n                    pid={this.state.pid} changePid={this.changePid} completed={this.state.page.completed} />\n            </div>\n        </div>\n    }\n}\n\nexport default ShowerMixer","import React, { useEffect } from 'react'\nimport Footer from './components/Footer'\nimport ShowerMixer from './components/ShowerMixer';\n\nconst App = props => {\n  const divStyle = {\n    marginLeft: 'auto',\n    marginRight: 'auto',\n    maxWidth: '600px'\n  }\n\n  useEffect(() => {\n    console.log('app effect')\n  })\n\n  return (\n    <div style={divStyle}>\n        <ShowerMixer location={window.location} />\n      <Footer />\n    </div>\n  )\n}\n\nexport default App","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}